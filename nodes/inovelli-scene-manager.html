<script src="./lib/util.js"></script>
<script type="text/javascript">
  RED.nodes.registerType("inovelli-scene-manager", {
    category: "inovelli",
    color: "#B68181",
    defaults: {
      name: { value: "" },
      nodeid: { value: [] },
      entityid: { value: "" },
      zwave: { value: "zwave_js" },
      switchtype: { value: "LZW30" },
      outputs: { value: 1 },
      labels: { value: ["Please select a Switch Type"] },
    },
    inputs: 1,
    outputs: 1,
    inputLabels: "Connect to appropriate Home Assistant node",
    outputLabels: function (index) {
      return this.labels[index];
    },
    icon: "light.svg",
    align: "right",
    label: function () {
      return this.name || "inovelli-scene-manager";
    },
    oneditprepare: function () {
      const zwaveSwitches = `<option value="LZW30">On/Off Switch (LZW30-SN)</option>
        <option value="LZW31">Dimmer Switch (LZW31-SN)</option>
        <option value="LZW36">Fan/Light Switch (LZW36)</option>
        <option value="LZW45">Lightstrip & Controller Kit (LZW45)</option>
        <option value="VZW31">2-1 Dimmer(VZW31-SN)</option>`;

      const zigbeeSwitches = `<option value="VZM31">Blue 2-1 Switch (VZM31-SN)</option>`;

      $("#node-input-zwave").change(function () {
        const switchInput = $("#node-input-switchtype");
        switch (this.value) {
          case "zwave_js":
          case "ozw":
            switchInput.html(zwaveSwitches);
            break;
          default:
            switchInput.html(zigbeeSwitches);
            break;
        }
      });

      // $("#node-input-entityid").autocomplete({
      //   source: function (request, response) {
      //     var haEntities = RED.settings.functionGlobalContext.get('homeassistant').homeAssistant.states;
      //     var filteredEntities = $.ui.autocomplete.filter(entities, request.term);
      //     response(filteredEntities);
      //   },
      //   minLength: 0,
      //   autoFocus: true,
      //   select: function (event, ui) {
      //     // If node.entityId already contains values, append with comma.
      //     if (node.entityid) {
      //       this.entityid += "," + ui.item.value;
      //     } else {
      //       this.entityid = ui.item.value;
      //     }

      //     // Update the input field with the new list.
      //     $("#node-input-entityid").val(this.entityid);

      //     // Prevent the default behavior of replacing the input field with the selected value.
      //     return false;
      //   }
      // }).focus(function () {
      //   // Show dropdown on focus.
      //   $(this).autocomplete("search", "");
      // });
    },
    oneditsave: function () {
      const OutputLabels = {
        "LZW30": [
          "Tap Up on Light Paddle 1x",
          "Tap Up on Light Paddle 2x",
          "Tap Up on Light Paddle 3x",
          "Tap Up on Light Paddle 4x",
          "Tap Up on Light Paddle 5x",
          "Hold Up on Light Paddle",
          "Release Up on Light Paddle",
          "Tap Down on Light Paddle 1x",
          "Tap Down on Light Paddle 2x",
          "Tap Down on Light Paddle 3x",
          "Tap Down on Light Paddle 4x",
          "Tap Down on Light Paddle 5x",
          "Hold Down on Light Paddle",
          "Release Down on Light Paddle",
          "Tap Config Button 1x",
        ],
        "LZW31": [
          "Tap Up on Light Paddle 1x",
          "Tap Up on Light Paddle 2x",
          "Tap Up on Light Paddle 3x",
          "Tap Up on Light Paddle 4x",
          "Tap Up on Light Paddle 5x",
          "Hold Up on Light Paddle",
          "Release Up on Light Paddle",
          "Tap Down on Light Paddle 1x",
          "Tap Down on Light Paddle 2x",
          "Tap Down on Light Paddle 3x",
          "Tap Down on Light Paddle 4x",
          "Tap Down on Light Paddle 5x",
          "Hold Down on Light Paddle",
          "Release Down on Light Paddle",
          "Tap Config Button 1x",
        ],
        "LZW36": [
          "Tap on Light Button 1x",
          "Tap on Light Button 2x",
          "Tap on Light Button 3x",
          "Tap on Light Button 4x",
          "Tap on Light Button 5x",
          "Hold on Light Button (3 Seconds)",
          "Release on Light (After Hold) Button",
          "Tap on Light Rocker Up",
          "Tap on Light Rocker Down",
          "Tap on Fan Button 1x",
          "Tap on Fan Button 2x",
          "Tap on Fan Button 3x",
          "Tap on Fan Button 4x",
          "Tap on Fan Button 5x",
          "Hold on Fan Button (3 Seconds)",
          "Release on Fan (After Hold) Button",
          "Tap on Fan Rocker Up",
          "Tap on Fan Rocker Down",
        ],
        "LZW45": [
          "Tap Up on Light Paddle 1x",
          "Tap Up on Light Paddle 2x",
          "Tap Up on Light Paddle 3x",
          "Tap Up on Light Paddle 4x",
          "Tap Up on Light Paddle 5x",
          "Hold Up on Light Paddle",
          "Release Up on Light Paddle",
          "Tap Down on Light Paddle 1x",
          "Tap Down on Light Paddle 2x",
          "Tap Down on Light Paddle 3x",
          "Tap Down on Light Paddle 4x",
          "Tap Down on Light Paddle 5x",
          "Hold Down on Light Paddle",
          "Release Down on Light Paddle",
          "Tap Config Button 1x",
        ],
        "VZW31":[
          "Tap Up on Light Paddle 1x",
          "Tap Up on Light Paddle 2x",
          "Tap Up on Light Paddle 3x",
          "Tap Up on Light Paddle 4x",
          "Tap Up on Light Paddle 5x",
          "Hold Up on Light Paddle",
          "Release Up on Light Paddle",
          "Tap Down on Light Paddle 1x",
          "Tap Down on Light Paddle 2x",
          "Tap Down on Light Paddle 3x",
          "Tap Down on Light Paddle 4x",
          "Tap Down on Light Paddle 5x",
          "Hold Down on Light Paddle",
          "Release Down on Light Paddle",
          "Tap Config Button 1x",
        ],
        "VZM31": [
          "Tap Up on Light Paddle 1x",
          "Tap Up on Light Paddle 2x",
          "Tap Up on Light Paddle 3x",
          "Tap Up on Light Paddle 4x",
          "Tap Up on Light Paddle 5x",
          "Hold Up on Light Paddle",
          "Release Up on Light Paddle",
          "Tap Down on Light Paddle 1x",
          "Tap Down on Light Paddle 2x",
          "Tap Down on Light Paddle 3x",
          "Tap Down on Light Paddle 4x",
          "Tap Down on Light Paddle 5x",
          "Hold Down on Light Paddle",
          "Release Down on Light Paddle",
          "Tap Config Button 1x",
          "Tap Config Button 2x",
        ],
      };
      const switchtype = $("#node-input-switchtype").val();
      this.outputs = OutputLabels[switchtype].length;
      this.labels = OutputLabels[switchtype];
    },
  });
</script>

<script type="text/x-red" data-template-name="inovelli-scene-manager">
  <style>
    .current-outputs {
      display: none;
    }
  </style>
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i>Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-zwave"><i class="icon-tag"></i>Home Assistant Integration</label>
    <select name="node-input-zwave" id="node-input-zwave">
        <option value="zwave_js">Z-Wave JS</option>
        <option value="ozw">Open Z-Wave</option>
        <option value="zha">ZHA</option>
        <option value="z2m">Zigbee2MQTT</option>
    </select>
  </div>
  <div class="form-row">
    <label for="node-input-nodeid"><i class="icon-tag"></i>Node/Device ID(s)</label>
    <input type="text" id="node-input-nodeid">
  </div>
  <div class="form-row">
    <label for="node-input-entityid"><i class="icon-tag"></i>Entity ID(s)</label>
    <input type="text" id="node-input-entityid">
  </div>
  <div class="form-row">
    <label for="node-input-switchtype"><i class="icon-tag"></i>Switch Type</label>
    <select name="node-input-switchtype" id="node-input-switchtype">
      <option value="0">Placeholder</option>
      <option value="1">Placeholder</option>
      <option value="2">Placeholder</option>
      <option value="3">Placeholder</option>
    </select>
  </div>
</script>

<script type="text/x-red" data-help-name="inovelli-scene-manager">
  <p>This node will decipher button clicks on an Inovelli Red Series switch allowing for easy scene control in Home Assistant. Just connect this input of this node to the output of a Home Assistant "events: all" node</p>
  <dl class="message-properties">
      <dt>Home Assistant Integration<span class="property-type">string</span></dt>
      <dd>Your device integration used in Home Assistant (ZWave JS, Open ZWave (deprecated), ZHA, or Zigbee2MQTT)</dd>

      <dt>Node/Device ID(s)<span class="property-type">number</span></dt>
      <dd>Node ID or Device ID (or a comma-delimited list of IDs) of the Inovelli switch(es) you are managing. Leaving empty will pass through ALL event messages.</dd>

      <dt>Entity ID(s)<span class="property-type">string</span></dt>
      <dd>Entity ID (or a comma-delimited list of entity IDs) to append to each message (sets msg.entity_id). Useful for controlling dedicated smart bulbs.</dd>

      <dt>Switch Type<span class="property-type">number|string</span></dt>
      <dd>Determines which Inovelli switch is being used. (LZW30-SN, LZW31-SN, LZW36, LZW45, VZM31)</dd>
  </dl>
</script>